/*1364513362,171329076*/

if (self.CavalryLogger) { CavalryLogger.start_js(["H\/9Of"]); }

__d("JSLoggerImpl",["Arbiter","AsyncRequest","Banzai","BanzaiODS","Env","ErrorUtils","JSLogger","OptionStorage","SystemEvents","copyProperties","emptyFunction","JSLoggerConfig"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AsyncRequest'),i=b('Banzai'),j=b('BanzaiODS'),k=b('Env'),l=b('ErrorUtils'),m=b('JSLogger'),n=b('OptionStorage'),o=b('SystemEvents'),p=b('copyProperties'),q=b('emptyFunction'),r=c('JSLoggerConfig'),s=m._,t,u='/ajax/chat/jslogger.php',v=m.create('jslogger');j=j.create();var w=-1,x=new n('JSLogger'),y={enabled_categories:null,categories:null,send_min:7500,send_max:60000};function z(ja){return r[ja]||y[ja];}function aa(ja){var ka=z('enabled_categories')||{},la=ja in ka?ka[ja]:ka.__default;return la;}function ba(ja,ka,event){}function ca(ja){var ka=x.get('filter');if(console&&console[ja.type]&&ka&&ka.test(ja.cat)){var la=(/(\d\d:\d\d:\d\d)/).test(new Date(ja.date))&&RegExp.$1,ma=la+' '+ja.cat+':'+ja.event;if(ja.data){console[ja.type](ma,JSON.parse(ja.data));}else console[ja.type](ma);}}function da(ja){var ka={page_id:s.pageId,env_start:k.start,now:Date.now()};if(ja){g.inform(m.DUMP_EVENT,ja);ka.dumpData=ja;ka.log=m.getEntries();}else{ka.log=m.getEntries(function(la){return (/log|warn|error/).test(la.type)&&aa(la.cat);},t);t=s.head;ka.counts=s.counts;s.counts={};}return ka;}function ea(ja,ka,la){var ma=da(ja);if(!ja){var na=false;for(var oa in ma.counts)na=na||oa!='jslogger';if(!na&&ma.log.length<=0)return;}if(i.isEnabled('jslogger')){delete ma.counts;i.post('jslogger',ma,{delay:0});j.flush();}else{ma=JSON.stringify(ma);var pa=new h().setURI(u+(ja?'?dump=1':'')).setMethod('POST').setData({clientState:ma}).setReadOnly(true).setAllowCrossPageTransition(true);if(ka)pa.setHandler(ka);pa.setErrorHandler(la||q);pa.send();}}function fa(){var ja=z('send_min'),ka=z('send_max'),la=ja*Math.pow(2,w+1);if(w>=0&&!s.forwarding){v.bump('send_t'+(la<=ka?w:'max'));ea();}w++;la*=.75+Math.random()/2;setTimeout(fa,la,false);}var ga=s.logAction;s.logAction=function(event,ja,ka){ba(this.type,this.cat,event);var la=ga.apply(this,arguments);if(i.isEnabled('jslogger'))if(this.type=='bump'){j.bumpEntityKey(this.cat,event,ja);}else if(this.type=='rate')j.bumpFraction(this.cat,event,ja?ka:0,ka);if(la){ca(la);while(t&&(s.head.seq-t.seq)>s.MAX_HISTORY){t=t.next;v.bump('dropped_entries');}}var ma=x.get('debugFilter');if(ma&&ma.test(event))debugger;};p(m,{setConsoleFilter:function(ja){if(!(ja instanceof RegExp))ja=ja?new RegExp(ja):null;x.set('filter',ja);},setDebugFilter:function(ja){if(!(ja instanceof RegExp))ja=ja?new RegExp(ja):null;x.set('debugFilter',ja);},replay:function(){for(var ja=s.tail;ja;ja=ja.next)ca(ja);},getDumpJSON:function(ja){return da({});},submitDump:function(ja,ka){ea(ja||{},function(la){var ma=la.getPayload();ka(ma);},function(){ka(null);});},dump:function(ja){this.submitDump(ja,function(ka){if(ka){prompt('JSLogger dump now available at:',ka);}else alert('Error while sending JSLogger dump');});}});fa();for(var ha=s.tail;ha;ha=ha.next)ca(ha);var ia=m.create('sys');l.addListener(function(ja){if(ja.message=='Script error.'){ia.bump('xdomain_error');ia.debug('xdomain_error');}else ia.error('uncaught_exception',ja);});o.subscribe(o.ONLINE,function(ja,ka){ia.warn(ka?'online':'offline');});o.subscribe(o.USER,function(ja,ka){ia.warn('user',{user:ka});});o.subscribe(o.TIME_TRAVEL,function(ja,ka){ia.warn('time_travel',{dt:ka});});});